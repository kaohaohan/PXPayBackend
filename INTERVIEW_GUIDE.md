# ğŸ¯ E-Commerce Backend - é¢è©¦æŠ€è¡“èªªæ˜

## å°ˆæ¡ˆäº®é» (Key Achievements)

### High-Concurrency Optimization
- ä½¿ç”¨ JMeter é€²è¡Œå£“åŠ›æ¸¬è©¦ï¼š100 ä½µç™¼ç”¨æˆ¶ Ã— 100,000 ç­†è³‡æ–™
- å¯¦ä½œä¸‰å±¤å„ªåŒ–æ¶æ§‹ï¼šDatabase Indexing + Redis Cache + Connection Pooling

### é‡åŒ–æˆæœ (Quantitative Results)

#### 1ï¸âƒ£ Database Indexing å„ªåŒ–
- **éŒ¯èª¤ç‡**: å¾ 80% é™è‡³ 0% (Zero downtime)
- **ååé‡**: å¾ 7.5 req/min æå‡è‡³ 44.8 req/sec (æå‡ ~300 å€)
- **å¹³å‡å›æ‡‰æ™‚é–“**: å¾ 9.5 ç§’é™è‡³ 2.2 ç§’ (æ”¹å–„ 76%)
- **æ™‚é–“è¤‡é›œåº¦**: O(n) â†’ O(log n)

#### 2ï¸âƒ£ Redis Cache å„ªåŒ–
- **Cache Miss**: 319ms (é¦–æ¬¡æŸ¥è©¢)
- **Cache Hit**: 58-60ms (å¾ŒçºŒæŸ¥è©¢)
- **æ•ˆèƒ½æå‡**: 5.3-5.5 å€
- **å¿«å–ç­–ç•¥**: Cache-Aside Patternï¼Œ5 åˆ†é˜éæœŸ

---

## ğŸ—ï¸ æŠ€è¡“æ¶æ§‹

### ä¸‰å±¤å„ªåŒ–æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 1: Database Indexing             â”‚
â”‚  - B-Tree Index on Product.Name         â”‚
â”‚  - StartsWith() â†’ LIKE 'keyword%'       â”‚
â”‚  - Time Complexity: O(log n)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 2: Redis Distributed Cache       â”‚
â”‚  - Cache-Aside Pattern                  â”‚
â”‚  - 5 min TTL (Time To Live)             â”‚
â”‚  - Time Complexity: O(1)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 3: Connection Pooling            â”‚
â”‚  - Min Pool Size: 10                    â”‚
â”‚  - Max Pool Size: 200                   â”‚
â”‚  - Prevents Socket Exhaustion           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š API ç«¯é»æ¯”è¼ƒ

### 1. `/api/products/search/{name}` - ç„¡å„ªåŒ–ç‰ˆæœ¬
- **æ–¹æ³•**: Contains() â†’ `LIKE '%keyword%'`
- **ç´¢å¼•**: âŒ ç„¡æ³•ä½¿ç”¨
- **å¿«å–**: âŒ ç„¡
- **æ•ˆèƒ½**: 200-300ms (å…¨è¡¨æƒæ)
- **é©ç”¨**: éœ€è¦æœå°‹ä»»æ„ä½ç½®çš„é—œéµå­—

### 2. `/api/products/search-starts-with/{name}` - ç´¢å¼•å„ªåŒ–ç‰ˆæœ¬
- **æ–¹æ³•**: StartsWith() â†’ `LIKE 'keyword%'`
- **ç´¢å¼•**: âœ… B-Tree Index
- **å¿«å–**: âŒ ç„¡
- **æ•ˆèƒ½**: 1-5ms (ç´¢å¼•æŸ¥è©¢)
- **é©ç”¨**: æœå°‹åç¨±é–‹é ­çš„é—œéµå­—

### 3. `/api/products/search-cached/{name}` - Redis å¿«å–ç‰ˆæœ¬
- **æ–¹æ³•**: StartsWith() â†’ `LIKE 'keyword%'`
- **ç´¢å¼•**: âœ… B-Tree Index
- **å¿«å–**: âœ… Redis (5 min TTL)
- **æ•ˆèƒ½**: 
  - Cache Miss: 319ms
  - Cache Hit: 58-60ms
- **é©ç”¨**: ç†±é–€å•†å“æœå°‹ã€é«˜æµé‡ API

---

## ğŸ” æŠ€è¡“æ·±åº¦èªªæ˜

### ç‚ºä»€éº¼ Contains() ç„¡æ³•ä½¿ç”¨ç´¢å¼•ï¼Ÿ

```sql
-- Contains() è½‰æ›æˆ SQL
WHERE Name LIKE '%å…¨è¯å…ˆç”Ÿ%'
```

**å•é¡Œ**: `%` åœ¨å‰é¢æœƒå°è‡´ï¼š
1. è³‡æ–™åº«ç„¡æ³•ä½¿ç”¨ B-Tree ç´¢å¼•
2. å¿…é ˆé€²è¡Œå…¨è¡¨æƒæ (Full Table Scan)
3. æ™‚é–“è¤‡é›œåº¦: O(n)

### ç‚ºä»€éº¼ StartsWith() å¯ä»¥ä½¿ç”¨ç´¢å¼•ï¼Ÿ

```sql
-- StartsWith() è½‰æ›æˆ SQL
WHERE Name LIKE 'å…¨è¯å…ˆç”Ÿ%'
```

**å„ªå‹¢**: æ²’æœ‰å‰ç½® `%`ï¼Œå¯ä»¥ï¼š
1. ä½¿ç”¨ B-Tree ç´¢å¼•é€²è¡Œå‰ç¶´æœå°‹
2. åªæƒæç¬¦åˆå‰ç¶´çš„è³‡æ–™
3. æ™‚é–“è¤‡é›œåº¦: O(log n)

### B-Tree ç´¢å¼•åŸç†

```
         [å…¨]
        /   \
    [å…¨å®¶]  [å…¨è¯]
           /    \
      [å…¨è¯å…ˆç”Ÿ] [å…¨è¯ç¦åˆ©ä¸­å¿ƒ]
```

- é¡ä¼¼äºŒå…ƒæœå°‹æ¨¹
- å¯ä»¥å¿«é€Ÿå®šä½å‰ç¶´
- æŸ¥è©¢æ•ˆç‡: O(log n)

---

## ğŸš€ Redis Cache-Aside Pattern

### å·¥ä½œæµç¨‹

```
1. æ”¶åˆ°è«‹æ±‚ â†’ æŸ¥è©¢ Redis
   â”œâ”€ Cache Hit â†’ ç›´æ¥è¿”å› (58-60ms)
   â””â”€ Cache Miss â†’ æŸ¥è©¢è³‡æ–™åº« (319ms)
                 â†’ å¯«å…¥ Redis
                 â†’ è¿”å›çµæœ
```

### ç‚ºä»€éº¼é¸æ“‡ Cache-Asideï¼Ÿ

1. **ç°¡å–®æ˜“æ‡‚**: é‚è¼¯æ¸…æ™°ï¼Œå®¹æ˜“ç¶­è­·
2. **é©åˆè®€å¤šå¯«å°‘**: é›»å•†æœå°‹å°±æ˜¯è®€å¤šå¯«å°‘
3. **å®¹éŒ¯æ€§å¥½**: Redis æ›æ‰é‚„èƒ½å¾ DB è®€å–
4. **æ¥­ç•Œæ¨™æº–**: æœ€å¸¸è¦‹çš„å¿«å–ç­–ç•¥

---

## ğŸ”§ Connection Pooling è§£æ±ºçš„å•é¡Œ

### å•é¡Œï¼šSocket Exhaustion (Socket è€—ç›¡)

**ç—‡ç‹€**:
```
java.net.SocketException: Socket closed
Error Rate: 80%
```

**åŸå› **:
- é«˜ä½µç™¼ä¸‹ï¼Œæ¯å€‹è«‹æ±‚éƒ½å»ºç«‹æ–°çš„ DB é€£ç·š
- é€£ç·šå»ºç«‹/é—œé–‰å¾ˆæ…¢ (TCP ä¸‰æ¬¡æ¡æ‰‹)
- ç³»çµ± Socket æ•¸é‡æœ‰é™

**è§£æ±ºæ–¹æ¡ˆ**:
```csharp
"Min Pool Size=10;Max Pool Size=200;Connection Timeout=30;"
```

- **Min Pool Size**: é å…ˆå»ºç«‹ 10 å€‹é€£ç·š
- **Max Pool Size**: æœ€å¤š 200 å€‹é€£ç·š
- **Connection Timeout**: 30 ç§’è¶…æ™‚

---

## ğŸ“ˆ JMeter å£“åŠ›æ¸¬è©¦

### æ¸¬è©¦è¨­å®š
- **Thread Count**: 100 (ä½µç™¼ç”¨æˆ¶)
- **Ramp-Up Period**: 1 ç§’
- **Loop Count**: 1
- **è³‡æ–™é‡**: 100,000 ç­†å•†å“

### æ¸¬è©¦çµæœå°æ¯”

| æŒ‡æ¨™ | ç„¡ç´¢å¼• | æœ‰ç´¢å¼• | æœ‰ç´¢å¼•+Redis |
|------|--------|--------|--------------|
| éŒ¯èª¤ç‡ | 80% | 0% | 0% |
| å¹³å‡å›æ‡‰æ™‚é–“ | 9.5s | 2.2s | 0.06s (Cache Hit) |
| ååé‡ | 7.5/min | 44.8/sec | ~1000/sec (Cache Hit) |

---

## ğŸ’¬ é¢è©¦æ™‚å¯ä»¥é€™æ¨£èªª

### 1. ä»‹ç´¹å°ˆæ¡ˆèƒŒæ™¯

> "æˆ‘åšäº†ä¸€å€‹é›»å•†å¾Œç«¯ APIï¼Œä¸»è¦è™•ç†å•†å“æœå°‹åŠŸèƒ½ã€‚åœ¨å£“åŠ›æ¸¬è©¦æ™‚ç™¼ç¾ï¼Œç•¶ 100 å€‹ç”¨æˆ¶åŒæ™‚æœå°‹ 10 è¬ç­†å•†å“æ™‚ï¼ŒéŒ¯èª¤ç‡é«˜é” 80%ï¼Œé€™æ˜¯ä¸å¯æ¥å—çš„ã€‚"

### 2. èªªæ˜å•é¡Œåˆ†æ

> "æˆ‘ç”¨ JMeter é€²è¡Œå£“åŠ›æ¸¬è©¦ï¼Œç™¼ç¾ä¸»è¦æœ‰å…©å€‹å•é¡Œï¼š
> 1. è³‡æ–™åº«æŸ¥è©¢å¤ªæ…¢ - å› ç‚ºä½¿ç”¨ Contains() ç„¡æ³•åˆ©ç”¨ç´¢å¼•
> 2. é«˜ä½µç™¼ä¸‹å‡ºç¾ Socket Exhaustion - å› ç‚ºæ²’æœ‰è¨­å®š Connection Pool"

### 3. èªªæ˜è§£æ±ºæ–¹æ¡ˆ

> "æˆ‘å¯¦ä½œäº†ä¸‰å±¤å„ªåŒ–ï¼š
> 
> **ç¬¬ä¸€å±¤ï¼šDatabase Indexing**
> - åœ¨ Product.Name æ¬„ä½å»ºç«‹ B-Tree ç´¢å¼•
> - å°‡æŸ¥è©¢å¾ Contains() æ”¹ç‚º StartsWith()
> - æ™‚é–“è¤‡é›œåº¦å¾ O(n) é™è‡³ O(log n)
> 
> **ç¬¬äºŒå±¤ï¼šRedis Cache**
> - ä½¿ç”¨ Cache-Aside Pattern
> - ç†±é–€æŸ¥è©¢å¾ Redis è®€å–ï¼Œå¿« 5 å€
> - è¨­å®š 5 åˆ†é˜ TTLï¼Œé¿å…è³‡æ–™éæœŸ
> 
> **ç¬¬ä¸‰å±¤ï¼šConnection Pooling**
> - è¨­å®š Min Pool Size 10, Max Pool Size 200
> - é¿å…é«˜ä½µç™¼ä¸‹çš„ Socket Exhaustion"

### 4. èªªæ˜æˆæœ

> "æœ€çµ‚çµæœï¼š
> - éŒ¯èª¤ç‡å¾ 80% é™è‡³ 0%
> - ååé‡æå‡ 300 å€
> - å¹³å‡å›æ‡‰æ™‚é–“æ”¹å–„ 76%
> - Cache Hit æƒ…æ³ä¸‹ï¼Œå›æ‡‰æ™‚é–“åªè¦ 60ms"

### 5. å±•ç¾å­¸ç¿’èƒ½åŠ›

> "é€™å€‹å°ˆæ¡ˆè®“æˆ‘å­¸åˆ°ï¼š
> 1. ç´¢å¼•çš„é‡è¦æ€§ - ä¸æ˜¯æ‰€æœ‰æŸ¥è©¢éƒ½èƒ½ç”¨ç´¢å¼•
> 2. å¿«å–ç­–ç•¥ - Cache-Aside é©åˆè®€å¤šå¯«å°‘çš„å ´æ™¯
> 3. ç³»çµ±èª¿å„ª - Connection Pool å¯ä»¥å¤§å¹…æå‡ä½µç™¼èƒ½åŠ›
> 4. æ¸¬è©¦é©—è­‰ - JMeter å¯ä»¥é‡åŒ–å„ªåŒ–æ•ˆæœ"

---

## ğŸ“ å¯èƒ½çš„é¢è©¦å•é¡Œ

### Q1: ç‚ºä»€éº¼ä¸ç”¨ Full-Text Searchï¼Ÿ

**A**: 
- Full-Text Search æ›´é©åˆè¤‡é›œçš„æ–‡å­—æœå°‹ï¼ˆå¦‚æœå°‹å¼•æ“ï¼‰
- æˆ‘å€‘çš„å ´æ™¯æ˜¯ç°¡å–®çš„å‰ç¶´æœå°‹ï¼ŒB-Tree Index å°±å¤ äº†
- B-Tree Index æ›´è¼•é‡ï¼Œç¶­è­·æˆæœ¬æ›´ä½

### Q2: Redis æ›æ‰æ€éº¼è¾¦ï¼Ÿ

**A**:
- Cache-Aside Pattern çš„å„ªå‹¢ï¼šRedis æ›æ‰é‚„èƒ½å¾ DB è®€å–
- å¯ä»¥åŠ  try-catchï¼ŒRedis å¤±æ•—æ™‚ç›´æ¥æŸ¥ DB
- ç”Ÿç”¢ç’°å¢ƒæœƒç”¨ Redis Cluster åšé«˜å¯ç”¨

### Q3: ç‚ºä»€éº¼ Cache è¨­å®š 5 åˆ†é˜éæœŸï¼Ÿ

**A**:
- å¹³è¡¡è³‡æ–™æ–°é®®åº¦å’Œæ•ˆèƒ½
- å•†å“è³‡æ–™ä¸å¸¸è®Šå‹•ï¼Œ5 åˆ†é˜æ˜¯åˆç†çš„
- å¦‚æœå•†å“æ›´æ–°ï¼Œå¯ä»¥æ‰‹å‹•æ¸…é™¤ Cache

### Q4: å¦‚æœè¦æ”¯æ´æ¨¡ç³Šæœå°‹æ€éº¼è¾¦ï¼Ÿ

**A**:
- å¯ä»¥ç”¨ Elasticsearch æˆ– Full-Text Search
- æˆ–è€…ç”¨ N-gram ç´¢å¼•
- æˆ–è€…å‰ç«¯ç”¨ StartsWithï¼Œå¾Œç«¯ç”¨ Contains åšäºŒæ¬¡éæ¿¾

### Q5: 100 ä½µç™¼ç®—é«˜å—ï¼Ÿ

**A**:
- å°å°å‹é›»å•†ä¾†èªªç®—é«˜äº†
- å¤§å‹é›»å•†å¯èƒ½ä¸Šåƒä¸Šè¬ä½µç™¼
- ä½†å„ªåŒ–æ€è·¯æ˜¯ä¸€æ¨£çš„ï¼šç´¢å¼• + å¿«å– + é€£ç·šæ± 

---

## ğŸ”— GitHub é€£çµ

**å°ˆæ¡ˆç¶²å€**: https://github.com/kaohaohan/E-Commerce-Backend

**é‡é» Commit**:
- Database Indexing: `docs: æ–°å¢è©³ç´°çš„æ•ˆèƒ½å„ªåŒ–è¨»è§£å’ŒæŠ€è¡“èªªæ˜`
- Redis Cache: `feat: æ–°å¢ Redis åˆ†æ•£å¼å¿«å–æ”¯æ´`
- Bug Fix: `fix: ä¿®æ­£ Redis Cache Hit åˆ¤æ–·é‚è¼¯`

---

## â° Demo æµç¨‹ï¼ˆé¢è©¦æ™‚ï¼‰

### 1. å±•ç¤ºä¸‰å€‹ API (5 åˆ†é˜)

```bash
# 1. ç„¡å„ªåŒ–ç‰ˆæœ¬ (Contains)
curl http://localhost:5000/api/products/search/å…¨è¯å…ˆç”Ÿ
# çµæœ: 200-300ms

# 2. ç´¢å¼•å„ªåŒ–ç‰ˆæœ¬ (StartsWith + Index)
curl http://localhost:5000/api/products/search-starts-with/å…¨è¯å…ˆç”Ÿ
# çµæœ: 1-5ms

# 3. Redis å¿«å–ç‰ˆæœ¬ (StartsWith + Index + Redis)
curl http://localhost:5000/api/products/search-cached/å…¨è¯å…ˆç”Ÿ
# ç¬¬ä¸€æ¬¡: 319ms (Cache Miss)
# ç¬¬äºŒæ¬¡: 58ms (Cache Hit)
```

### 2. å±•ç¤ºç¨‹å¼ç¢¼ (3 åˆ†é˜)

- `Product.cs`: å±•ç¤º `[Index(nameof(Name))]`
- `ProductService.cs`: å±•ç¤º `Contains()` vs `StartsWith()`
- `ProductService.cs`: å±•ç¤º Redis Cache-Aside Pattern
- `appsettings.json`: å±•ç¤º Connection Pool è¨­å®š

### 3. å±•ç¤º JMeter æ¸¬è©¦çµæœ (2 åˆ†é˜)

- å±•ç¤º Summary Report
- èªªæ˜éŒ¯èª¤ç‡ã€ååé‡ã€å›æ‡‰æ™‚é–“çš„æ”¹å–„

---

## ğŸ“š å»¶ä¼¸å­¸ç¿’

å¦‚æœé¢è©¦å®˜å•ã€Œé‚„å¯ä»¥æ€éº¼å„ªåŒ–ï¼Ÿã€ï¼š

1. **Read Replica**: è®€å¯«åˆ†é›¢ï¼Œè®€å–ç”¨ Slave DB
2. **CDN**: éœæ…‹è³‡æºç”¨ CDN åŠ é€Ÿ
3. **Load Balancer**: å¤šå°ä¼ºæœå™¨è² è¼‰å‡è¡¡
4. **Message Queue**: éåŒæ­¥è™•ç†ï¼Œæ¸›å°‘å›æ‡‰æ™‚é–“
5. **Database Sharding**: è³‡æ–™åˆ†ç‰‡ï¼Œæ°´å¹³æ“´å±•

---

## ğŸ¯ ç¸½çµ

é€™å€‹å°ˆæ¡ˆå±•ç¾äº†æˆ‘ï¼š
1. âœ… **å•é¡Œåˆ†æèƒ½åŠ›** - ç”¨ JMeter æ‰¾å‡ºç“¶é ¸
2. âœ… **æŠ€è¡“å¯¦ä½œèƒ½åŠ›** - å¯¦ä½œ Index + Redis + Connection Pool
3. âœ… **æ•ˆèƒ½å„ªåŒ–èƒ½åŠ›** - éŒ¯èª¤ç‡å¾ 80% é™è‡³ 0%
4. âœ… **é‡åŒ–æ€ç¶­** - ç”¨æ•¸æ“šè­‰æ˜å„ªåŒ–æ•ˆæœ
5. âœ… **å­¸ç¿’èƒ½åŠ›** - å¾å•é¡Œä¸­å­¸ç¿’æ–°æŠ€è¡“

**é©åˆè·ä½**: Full Stack Developer, Backend Engineer, éœ€è¦è™•ç†é«˜æµé‡çš„é›»å•†/ç¤¾ç¾¤å¹³å°

---

ç¥é¢è©¦é †åˆ©ï¼ğŸš€

